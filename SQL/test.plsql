CREATE MATERIALIZED VIEW test_flight2 AS WITH subclasses as (SELECT  max(demo_test_1000.fid) AS subclass, count(distinct demo_test_1000.thunder::NUMERIC), demo_test_1000.fog AS fog_matched, demo_test_1000.hail AS hail_matched, demo_test_10000.rain AS rain_matched, demo_test_10000.snow AS snow_matched, demo_test_10000.tornado AS tornado_matched FROM demo_test_1000, demo_test_10000 GROUP BY fog_matched, hail_matched, rain_matched, snow_matched, tornado_matched HAVING count(distinct demo_test_1000.thunder::INTEGER)::INTEGER = 2) SELECT demo_test_1000.yyear, demo_test_1000.quarter, demo_test_1000.month, demo_test_1000.dayofmonth, demo_test_1000.dayofweek, demo_test_1000.flightdate, demo_test_1000.uniquecarrier, demo_test_1000.airlineid, demo_test_1000.carrier, demo_test_1000.tailnum, demo_test_1000.flightnum, demo_test_1000.originairportid, demo_test_1000.originairportseqid, demo_test_1000.origincitymarketid, demo_test_1000.origin, demo_test_1000.origincityname, demo_test_1000.originstate, demo_test_1000.originstatefips, demo_test_1000.originstatename, demo_test_1000.originwac, demo_test_1000.destairportid, demo_test_1000.destairportseqid, demo_test_1000.destcitymarketid, demo_test_1000.dest, demo_test_1000.destcityname, demo_test_1000.deststate, demo_test_1000.deststatefips, demo_test_1000.deststatename, demo_test_1000.destwac, demo_test_1000.crsdeptime, demo_test_1000.deptime, demo_test_1000.depdelay, demo_test_1000.depdelayminutes, demo_test_1000.depdel15, demo_test_1000.departuredelaygroups, demo_test_1000.deptimeblk, demo_test_1000.taxiout, demo_test_1000.wheelsoff, demo_test_1000.wheelson, demo_test_1000.taxiin, demo_test_1000.crsarrtime, demo_test_1000.arrtime, demo_test_1000.arrdelay, demo_test_1000.arrdelayminutes, demo_test_1000.arrdel15, demo_test_1000.arrivaldelaygroups, demo_test_1000.arrtimeblk, demo_test_1000.cancelled, demo_test_1000.cancellationcode, demo_test_1000.diverted, demo_test_1000.crselapsedtime, demo_test_1000.actualelapsedtime, demo_test_1000.airtime, demo_test_1000.flights, demo_test_1000.distance, demo_test_1000.distancegroup, demo_test_1000.carrierdelay, demo_test_1000.weatherdelay, demo_test_1000.nasdelay, demo_test_1000.securitydelay, demo_test_1000.lateaircraftdelay, demo_test_1000.firstdeptime, demo_test_1000.totaladdgtime, demo_test_1000.longestaddgtime, demo_test_1000.fid, demo_test_1000.delay, demo_test_1000.ccity, demo_test_1000.code, demo_test_1000.conds, demo_test_1000.dewpti, demo_test_1000.dewptm, demo_test_1000.fog, demo_test_1000.hail, demo_test_1000.heatindexi, demo_test_1000.heatindexm, demo_test_1000.hour, demo_test_1000.hum, demo_test_1000.icon, demo_test_1000.mday, demo_test_1000.metar, demo_test_1000.min, demo_test_1000.mon, demo_test_1000.myday, demo_test_1000.myear, demo_test_1000.mymonth, demo_test_1000.precipi, demo_test_1000.precipm, demo_test_1000.pressurei, demo_test_1000.pressurem, demo_test_1000.pretty, demo_test_1000.rain, demo_test_1000.snow, demo_test_1000.tempi, demo_test_1000.tempm, demo_test_1000.thunder, demo_test_1000.tornado, demo_test_1000.tzname, demo_test_1000.visi, demo_test_1000.vism, demo_test_1000.wdird, demo_test_1000.wdire, demo_test_1000.wgusti, demo_test_1000.wgustm, demo_test_1000.windchilli, demo_test_1000.windchillm, demo_test_1000.wspdi, demo_test_1000.wspdm, demo_test_1000.year, demo_test_1000.wid, demo_test_1000.date, demo_test_1000.weather_date, demo_test_1000.weather_obs_time, demo_test_1000.wrid, demo_test_1000.dist, demo_test_1000.n, demo_test_1000.depdelay_int, demo_test_10000.yyear, demo_test_10000.quarter, demo_test_10000.month, demo_test_10000.dayofmonth, demo_test_10000.dayofweek, demo_test_10000.flightdate, demo_test_10000.uniquecarrier, demo_test_10000.airlineid, demo_test_10000.carrier, demo_test_10000.tailnum, demo_test_10000.flightnum, demo_test_10000.originairportid, demo_test_10000.originairportseqid, demo_test_10000.origincitymarketid, demo_test_10000.origin, demo_test_10000.origincityname, demo_test_10000.originstate, demo_test_10000.originstatefips, demo_test_10000.originstatename, demo_test_10000.originwac, demo_test_10000.destairportid, demo_test_10000.destairportseqid, demo_test_10000.destcitymarketid, demo_test_10000.dest, demo_test_10000.destcityname, demo_test_10000.deststate, demo_test_10000.deststatefips, demo_test_10000.deststatename, demo_test_10000.destwac, demo_test_10000.crsdeptime, demo_test_10000.deptime, demo_test_10000.depdelay, demo_test_10000.depdelayminutes, demo_test_10000.depdel15, demo_test_10000.departuredelaygroups, demo_test_10000.deptimeblk, demo_test_10000.taxiout, demo_test_10000.wheelsoff, demo_test_10000.wheelson, demo_test_10000.taxiin, demo_test_10000.crsarrtime, demo_test_10000.arrtime, demo_test_10000.arrdelay, demo_test_10000.arrdelayminutes, demo_test_10000.arrdel15, demo_test_10000.arrivaldelaygroups, demo_test_10000.arrtimeblk, demo_test_10000.cancelled, demo_test_10000.cancellationcode, demo_test_10000.diverted, demo_test_10000.crselapsedtime, demo_test_10000.actualelapsedtime, demo_test_10000.airtime, demo_test_10000.flights, demo_test_10000.distance, demo_test_10000.distancegroup, demo_test_10000.carrierdelay, demo_test_10000.weatherdelay, demo_test_10000.nasdelay, demo_test_10000.securitydelay, demo_test_10000.lateaircraftdelay, demo_test_10000.firstdeptime, demo_test_10000.totaladdgtime, demo_test_10000.longestaddgtime, demo_test_10000.fid, demo_test_10000.delay, demo_test_10000.ccity, demo_test_10000.code, demo_test_10000.conds, demo_test_10000.dewpti, demo_test_10000.dewptm, demo_test_10000.fog, demo_test_10000.hail, demo_test_10000.heatindexi, demo_test_10000.heatindexm, demo_test_10000.hour, demo_test_10000.hum, demo_test_10000.icon, demo_test_10000.mday, demo_test_10000.metar, demo_test_10000.min, demo_test_10000.mon, demo_test_10000.myday, demo_test_10000.myear, demo_test_10000.mymonth, demo_test_10000.precipi, demo_test_10000.precipm, demo_test_10000.pressurei, demo_test_10000.pressurem, demo_test_10000.pretty, demo_test_10000.rain, demo_test_10000.snow, demo_test_10000.tempi, demo_test_10000.tempm, demo_test_10000.thunder, demo_test_10000.tornado, demo_test_10000.tzname, demo_test_10000.visi, demo_test_10000.vism, demo_test_10000.wdird, demo_test_10000.wdire, demo_test_10000.wgusti, demo_test_10000.wgustm, demo_test_10000.windchilli, demo_test_10000.windchillm, demo_test_10000.wspdi, demo_test_10000.wspdm, demo_test_10000.year, demo_test_10000.wid, demo_test_10000.date, demo_test_10000.weather_date, demo_test_10000.weather_obs_time, demo_test_10000.wrid, demo_test_10000.dist, demo_test_10000.n, demo_test_10000.depdelay_int FROM subclasses, demo_test_1000, demo_test_10000 WHERE subclasses.fog_matched = demo_test_1000.fog AND subclasses.hail_matched = demo_test_1000.hail AND subclasses.rain_matched = demo_test_10000.rain AND subclasses.snow_matched = demo_test_10000.snow AND subclasses.tornado_matched = demo_test_10000.tornado WITH DATA;